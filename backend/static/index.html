<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="screen">
        <div class="login-container">
            <h1>Timeline</h1>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="remember-me" name="remember-me">
                        <span class="checkbox-custom"></span>
                        Remember me
                    </label>
                </div>
                <button type="submit">Sign In</button>
            </form>
            <div id="login-error" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-screen" class="screen" style="display: none;">
        <div class="admin-header">
            <h1>Admin Dashboard</h1>
            <div class="admin-actions">
                <button id="admin-change-password-btn" class="admin-btn">Change Password</button>
                <button id="admin-logout-btn" class="admin-btn">Sign Out</button>
            </div>
        </div>
        
        <div class="admin-content">
            <div class="admin-section">
                <h2>User Management</h2>
                <div class="user-management">
                    <div class="add-user-section">
                        <h3>Add User</h3>
                        <form id="add-user-form">
                            <div class="form-group">
                                <label for="new-username">Username:</label>
                                <input type="text" id="new-username" name="username" required>
                            </div>
                            <button type="submit">Add User</button>
                        </form>
                    </div>
                    
                    <div class="user-list-section">
                        <h3>Existing Users</h3>
                        <div id="user-list" class="user-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Timeline -->
    <div id="user-screen" class="screen" style="display: none;">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="top-bar-left">
                <button id="notes-btn" class="notes-button">Notes</button>
                <div class="event-count">
                    <span id="total-event-count">0 Events in the list</span>
                </div>
            </div>
            <div class="top-bar-center">
                <span id="user-display-name"></span>
            </div>
            <div class="top-bar-right">
                <button id="burger-btn" class="burger-button">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div id="burger-menu-content" class="burger-menu-content" style="display: none;">
                    <button id="settings-btn">Settings</button>
                    <button id="export-pdf-btn">Export as PDF</button>
                    <button id="backup-btn">Backup</button>
                    <button id="user-logout-btn">Sign Out</button>
                </div>
            </div>
        </div>

        <!-- Timeline Content -->
        <div class="timeline-content">
            <div class="timeline-container" id="timeline-container">
                <div class="timeline-line"></div>
                <div id="events-container" class="events-container"></div>
                
                <!-- Empty State -->
                <div id="empty-state" class="empty-state" style="display: none;">
                    <div class="empty-state-content">
                        <button id="empty-add-events-btn" class="add-event-button">Add Events</button>
                        <span class="empty-state-text"> to view the timeline</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Bar -->
        <div class="bottom-bar">
            <div class="left-section">
                <div class="search-section">
                    <div class="search-container">
                        <input type="text" id="search-input" placeholder="Search events..." class="search-input">
                        <button id="search-btn" class="search-button">Search</button>
                    </div>
                </div>
                
                <div class="filter-section">
                    <button id="tag-filter-btn" class="tag-filter-button">Tags</button>
                    <div id="tag-filter-menu" class="tag-filter-menu" style="display: none;">
                        <div class="tag-filter-list" id="tag-filter-list"></div>
                    </div>
                </div>
            </div>
            
            <div class="right-section">
                <div class="filtered-count">
                    <span id="filtered-event-count">0 Events</span>
                </div>
                
                <div class="add-event-section">
                    <button id="add-event-btn" class="add-event-button">Add Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlays -->
    
    <!-- Settings Overlay -->
    <div id="settings-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Settings</h2>
                <button class="close-overlay" id="close-settings">&times;</button>
            </div>
            
            <div class="settings-sections">
                <div class="settings-section">
                    <h3>Display Name</h3>
                    <div class="form-group">
                        <input type="text" id="display-name" placeholder="Enter display name">
                        <button id="save-display-name" class="save-btn">Save</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Change Password</h3>
                    <div class="form-group">
                        <input type="password" id="old-password" placeholder="Old password">
                    </div>
                    <div class="form-group">
                        <input type="password" id="new-password" placeholder="New password">
                    </div>
                    <div class="form-group">
                        <input type="password" id="confirm-password" placeholder="Confirm new password">
                    </div>
                    <button id="change-password" class="save-btn">Change Password</button>
                </div>
                
                <div class="settings-section">
                    <h3>Theme</h3>
                    <div class="form-group">
                        <select id="theme-select">
                            <option value="device">Device</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                        <button id="save-theme" class="save-btn">Save</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Time Format</h3>
                    <div class="form-group">
                        <select id="time-format-select">
                            <option value="24h">24H</option>
                            <option value="12h">AM/PM</option>
                        </select>
                        <button id="save-time-format" class="save-btn">Save</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Date Format</h3>
                    <div class="form-group">
                        <select id="date-format-select">
                            <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                            <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                            <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                            <option value="dd mmm yyyy">1 January 2000</option>
                        </select>
                        <button id="save-date-format" class="save-btn">Save</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Time Separators</h3>
                    <div class="form-group">
                        <select id="time-separator-select">
                            <option value="disabled">Disabled</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                        <button id="save-time-separator" class="save-btn">Save</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Accent Colour</h3>
                    <div class="form-group">
                        <input type="text" id="accent-color" placeholder="#710193" pattern="^#[0-9A-Fa-f]{6}$">
                        <button id="save-accent-color" class="save-btn">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Backup Overlay -->
    <div id="backup-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Backup</h2>
                <button class="close-overlay" id="close-backup">&times;</button>
            </div>
            
            <div class="backup-sections">
                <div class="backup-section">
                    <h3>Export</h3>
                    <p>Download all events as a JSON file</p>
                    <button id="export-btn" class="backup-btn">Export Events</button>
                </div>
                
                <div class="backup-section">
                    <h3>Import</h3>
                    <p>Upload a JSON file to add events</p>
                    <input type="file" id="import-file" accept=".json" style="display: none;">
                    <button id="import-btn" class="backup-btn">Import Events</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Export Overlay -->
    <div id="pdf-export-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Export as PDF</h2>
                <button class="close-overlay" id="close-pdf-export">&times;</button>
            </div>
            
            <div class="pdf-export-sections">
                <div class="pdf-export-section">
                    <h3>File Name</h3>
                    <div class="form-group">
                        <label for="pdf-filename">PDF file name:</label>
                        <input type="text" id="pdf-filename" placeholder="export" class="pdf-filename-input">
                        <span class="pdf-extension">.pdf</span>
                    </div>
                </div>
                
                <div class="pdf-export-section">
                    <h3>Select Labels</h3>
                    <p>Choose which labels to include in the PDF export</p>
                    <div id="pdf-label-list" class="pdf-label-list">
                        <!-- Labels will be populated dynamically -->
                    </div>
                </div>
                
                <div class="pdf-export-section">
                    <button id="generate-pdf-btn" class="pdf-export-btn">Export PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Export Error Overlay -->
    <div id="pdf-export-error-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Export Error</h2>
                <button class="close-overlay" id="close-pdf-error">&times;</button>
            </div>
            <div class="error-content">
                <p>Please select at least one label to include in the PDF export.</p>
                <button id="pdf-error-ok" class="primary-btn">OK</button>
            </div>
        </div>
    </div>

    <!-- Notes Overlay -->
    <div id="notes-overlay" class="overlay" style="display: none;">
        <div class="overlay-content notes-content">
            <div class="overlay-header">
                <h2>Notes</h2>
                <button class="close-overlay" id="close-notes">&times;</button>
            </div>
            
            <div class="notes-section">
                <div class="notes-status">
                    <small id="notes-status-text">Your notes are saved.</small>
                </div>
                <textarea id="notes-textarea" placeholder="Write your notes here..."></textarea>
            </div>
        </div>
    </div>

    <!-- Add Event Overlay -->
    <div id="add-event-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Add Event</h2>
                <button class="close-overlay" id="close-add-event">&times;</button>
            </div>
            
            <form id="add-event-form">
                <div class="form-group">
                    <label for="event-title">Title *</label>
                    <input type="text" id="event-title" required>
                </div>
                
                <div class="form-group">
                    <label for="event-description">Description *</label>
                    <textarea id="event-description" required rows="4"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Time *</label>
                    <div class="time-selector">
                        <div class="time-switch-container">
                            <label class="toggle-switch">
                                <input type="checkbox" id="time-toggle">
                                <span class="toggle-slider"></span>
                                <span class="toggle-labels">
                                    <span class="toggle-label-now">Now</span>
                                    <span class="toggle-label-custom">Custom</span>
                                </span>
                            </label>
                        </div>
                        <div id="custom-time-inputs" class="custom-time-inputs" style="display: none;">
                            <input type="number" id="day" placeholder="Day" min="1" max="31">
                            <input type="number" id="month" placeholder="Month" min="1" max="12">
                            <input type="number" id="year" placeholder="Year" min="1900" max="2100">
                            <input type="number" id="hour" placeholder="Hour" min="0" max="23">
                            <input type="number" id="minute" placeholder="Minute" min="0" max="59">
                            <input type="number" id="second" placeholder="Second" min="0" max="59">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Tags</label>
                    <div class="tags-container">
                        <div id="available-tags" class="available-tags"></div>
                        <div class="new-tag-input">
                            <input type="text" id="new-tag-name" placeholder="Add new tag">
                            <button type="button" id="add-tag-btn">Add</button>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="create-event-btn">Create Event</button>
            </form>
        </div>
    </div>

    <!-- Admin Password Change Overlay -->
    <div id="admin-password-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Change Admin Password</h2>
                <button class="close-overlay" id="close-admin-password">&times;</button>
            </div>
            
            <form id="admin-password-form">
                <div class="form-group">
                    <label for="admin-old-password">Current Password</label>
                    <input type="password" id="admin-old-password" required>
                </div>
                <div class="form-group">
                    <label for="admin-new-password">New Password</label>
                    <input type="password" id="admin-new-password" required>
                </div>
                <div class="form-group">
                    <label for="admin-confirm-password">Confirm New Password</label>
                    <input type="password" id="admin-confirm-password" required>
                </div>
                <button type="submit">Change Password</button>
            </form>
        </div>
    </div>

    <!-- User Add Success Overlay -->
    <div id="user-add-success-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>User Created</h2>
                <button class="close-overlay" id="close-user-success">&times;</button>
            </div>
            <div class="success-content">
                <p>User has been created successfully!</p>
                <p><strong>Username:</strong> <span id="success-username"></span></p>
                <p><strong>Password:</strong> <span id="success-password"></span></p>
                <p class="warning">Please save this password. It will not be shown again.</p>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Overlays -->
    <div id="delete-confirmation-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2 id="delete-title">Confirm Deletion</h2>
                <button class="close-overlay" id="close-delete-confirmation">&times;</button>
            </div>
            <div class="delete-content">
                <p id="delete-message">Are you sure you want to delete this item?</p>
                <div class="form-group" id="confirmation-input-group" style="display: none;">
                    <label id="confirmation-label">Enter name to confirm:</label>
                    <input type="text" id="confirmation-input">
                </div>
                <div class="delete-actions">
                    <button id="cancel-delete" class="cancel-btn">Cancel</button>
                    <button id="confirm-delete" class="delete-btn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Change Overlays -->
    <div id="password-confirm-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Confirm Password Change</h2>
                <button class="close-overlay" id="close-password-confirm">&times;</button>
            </div>
            <div class="password-confirm-content">
                <p>Changing your password will temporarily decrypt and re-encrypt all your data. This process is secure but may take a moment.</p>
                <p><strong>During this process:</strong></p>
                <ul>
                    <li>Your data will be temporarily decrypted in browser memory</li>
                    <li>All encrypted data will be cleared from the server</li>
                    <li>Your password will be updated</li>
                    <li>All data will be re-encrypted with the new password</li>
                    <li>Data will be restored to the server</li>
                </ul>
                <p class="warning">This process maintains zero-knowledge security and your data will be preserved.</p>
                <div class="password-confirm-actions">
                    <button id="cancel-password-change" class="cancel-btn">Cancel</button>
                    <button id="confirm-password-change" class="confirm-btn">Continue</button>
                </div>
            </div>
        </div>
    </div>

    <div id="password-error-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Password Change Error</h2>
                <button class="close-overlay" id="close-password-error">&times;</button>
            </div>
            <div class="error-content">
                <p id="password-error-message">An error occurred during password change.</p>
            </div>
        </div>
    </div>

    <div id="password-success-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Password Changed Successfully</h2>
                <button class="close-overlay" id="close-password-success">&times;</button>
            </div>
            <div class="success-content">
                <p>Your password has been changed successfully!</p>
                <p>All your data has been preserved and re-encrypted with the new password.</p>
                <p class="info">You may now continue using the application with your new password.</p>
            </div>
        </div>
    </div>

    <!-- General Message Overlays -->
    <div id="info-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2 id="info-title">Information</h2>
                <button class="close-overlay" id="close-info">&times;</button>
            </div>
            <div class="info-content">
                <p id="info-message">Information message</p>
            </div>
        </div>
    </div>

    <div id="error-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2 id="error-title">Error</h2>
                <button class="close-overlay" id="close-error">&times;</button>
            </div>
            <div class="error-content">
                <p id="error-message">Error message</p>
            </div>
        </div>
    </div>

    <div id="success-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2 id="success-title">Success</h2>
                <button class="close-overlay" id="close-success">&times;</button>
            </div>
            <div class="success-content">
                <p id="success-message">Success message</p>
            </div>
        </div>
    </div>

    <!-- Admin Password Change Confirmation -->
    <div id="admin-password-confirm-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Admin Password Change</h2>
                <button class="close-overlay" id="close-admin-password-confirm">&times;</button>
            </div>
            <div class="password-confirm-content">
                <p>Are you sure you want to change the admin password?</p>
                <p class="warning">This action will update the administrator credentials immediately.</p>
                <div class="password-confirm-actions">
                    <button id="cancel-admin-password-change" class="cancel-btn">Cancel</button>
                    <button id="confirm-admin-password-change" class="confirm-btn">Change Password</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Prompt Overlay (for page refresh authentication) -->
    <div id="password-prompt-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2>Enter Password</h2>
                <button class="close-overlay" id="password-prompt-close">&times;</button>
            </div>
            <div class="password-prompt-content">
                <p>Please enter your password to decrypt your data.</p>
                <p class="info-text">Your session is valid, but your encryption key is needed to access your timeline events.</p>
                <form id="password-prompt-form">
                    <div class="form-group">
                        <label for="password-prompt-input">Password:</label>
                        <input type="password" id="password-prompt-input" required autocomplete="current-password">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="primary-btn">Unlock Timeline</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="/static/crypto.js"></script></script></script>
    <script src="/static/app.js"></script>
</body>
</html>